import streamlit as st

st.set_page_config(
    page_title="Maths",
    page_icon=":nerd_face:",
    layout="wide"
)

st.title("Show me the Maths! :heart:  :nerd_face:  :see_no_evil:")
st.header('Static modelling of the jaw-closing system')
st.markdown('Our objective is to calculate the forces and joint moment acting on the mandible during an incisor bite.')
st.markdown('The maximal isomteric muscle force (*F<sub>muscle</sub>* in N) is the product of the physiological cross-section area (*PCSA* in cm²) and the maximum fibre strength (*σ<sub>fibre</sub>* in N/cm²). The PCSA is the area of the cross section of a muscle perpendicular to its fibres, and is calculated based on the data collected during the quantitative dissection. The contractile properties of muscle fibres can be measured *in vitro*, but this necessitates fresh muscle fibres which are not alaways available. The maximum fibre strength is hence based on published values.', unsafe_allow_html=True)
st.latex(r'''F_{muscle} = PCSA \cdot \sigma_{fibre}''')
st.write(r'''The jaw-closing system functions as a third-class lever, which is represented by the following **free body diagram**:''')
st.image('fig_statics.jpg')
st.write('**At the equilibrium** the sum of the force (*F*) and joint moments (*M*) equals zero:')
st.latex(r'''\sum F = 0''')
st.latex(r'''\sum M = 0''')
st.markdown('When the muscles contract, they generate a **moment (*M*, in N.mm)** around the jaw joint. The moment caused by the muscle force is the magnitude of the muscle force (in N) times its moment arm (*d<sub>muscle</sub>*, in mm), which is the perpendicular distance to the line of action of the muscle:', unsafe_allow_html=True)
st.latex(r'''M_{joint} = F_{muscle} \cdot d_{muscle}''')
st.markdown('For the system to be at equilibrium the moment generated by the muscle force should be opposed by a moment in the other direction. In our case, this moment is caused by the bite force on the teeth (*F<sub>bite</sub>*), whose direction is opposite to the muscle force. Just like the muscle force, the magnitude of the moment around the jaw joint generated by the bite force is proportional to the length of its moment arm (*d<sub>outLever</sub>*), which we call the out-lever:', unsafe_allow_html=True)
st.latex(r'''F_{muscle} \cdot d_{muscle} - F_{bite} \cdot d_{outLever}= M_{joint}''')
st.write('At the equilibrium, the magnitude of the moment at the jaw joint is 0. We can hence easily calculate the magnitude of the bite force:')
st.latex(r'''F_{muscle} \cdot d_{muscle} - F_{bite} \cdot d_{outLever} = 0''')
st.latex(r'''F_{bite} = -\frac{F_{muscle} \cdot d_{muscle}}{d_{outLever}}''')
st.write('So the **amount of muscle force converted into bite force** is proportional to the ratio between the lengths of muscle moment arm and the out-lever:')
st.latex(r'''F_{bite} = -F_{muscle}\cdot\frac{d_{muscle}}{d_{outLever}}''')
st.latex(r'''\lvert -\frac{F_{bite}}{F_{muscle}} \rvert = \lvert \frac{d_{muscle}}{d_{outLever}} \rvert''')
st.write('The ratio between the lengths of muscle moment arm and the out-lever is called the **mechanical advantage**. The ratio between the magnitude of the bite force and muscle force is called the **biting efficiency**. They have different names because they are calculated with different variables (distance and force) but they represent the same concept.')
st.markdown('The jaw moment is now at equilibrium, but we still need to work out the net forces. Indeed, the magnitude of the muscle force is greater than the bite force. The magnitude of the joint reaction force (*F<sub>joint</sub>*) needs to be calculated for the net force to equal zero:', unsafe_allow_html=True)
st.latex(r'''F_{muscle} + F_{joint} - F_{bite} = 0''')
st.latex(r'''F_{muscle} - F_{bite} = - F_{joint}''')
st.markdown('The magnitude and direction of the joint-reaction force *F<sub>joint</sub>* can be represented on the free body diagram:', unsafe_allow_html=True)
st.image('fig_statics_f.jpg')
st.write('We have now solved our static model: all moments and forces are now at equilibrium. The model you will use does exactly the same thing, and can allow us to include several muscles and calculate the different variables for different jaw gape angles.')
st.header('The meaning of it all')
st.write('Physical modelling gives us important insights into the way biological systems function, can achieve a given functional output, and utimately the form-function relationships. With respect to the primate feeding system we have seen that the magnitude of the bite force is given by:')
st.latex(r'''F_{bite} = F_{muscle} \cdot \frac{d_{muscle}}{d_{outLever}}''')
st.latex(r'''F_{bite} = PCSA \cdot \sigma_{fibre} \cdot \frac{d_{muscle}}{d_{outLever}}''')
st.write('This equation tells us several things. First, there is not a single way to change the output of this biological sytem. To increase bite force, one can increase the PCSA, the fibre strength, the moment arm of the muscle, or decrease the out-lever. Second, consequently, organisms with different morphologies can achieve the same functional output: this is what is called *many-to-one mapping* in evolutinary biology. Finally, there are fundamental constraints on the ability of the feeding system to generate and transmit forces to the bite point, which result in *functional trade-offs*. For instance, decreasing the out-lever to increase bite force decreases the mouth gape, as the mandible is shortened. A smaller mouth gape imposes a limitation on the size of the food item that can be bitten.')
